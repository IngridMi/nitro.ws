"use strict";var ownedGuilds;function collectForm(){var b={};A("#prefix")?b.prefix=A("#prefix"):0;var f={on:B("#adblock-toggle"),strikes:B("#adblock-strikes"),notify:B("#adblock-notify"),ex:{}},h=$("#adblock-users").material_chip("data"),j={};h.forEach(function(r){!/[^0123456789]/g.test(r.tag)&&/\d{17,}/g.test(r.tag)&&(j[r.tag]=!0)}),f.ex.users=j;var k=$("#adblock-roles").material_chip("data"),l={};k.forEach(function(r){!/[^0123456789]/g.test(r.tag)&&/\d{17,}/g.test(r.tag)&&(l[r.tag]=!0)}),f.ex.roles=l,b.adblock=f;var m={strikes:B("#filter-strikes")},o=$("#filter-keywords").material_chip("data"),p={};o.forEach(function(r){p[r.tag]=!0}),m.keywords=p,b.filter=m,A("#joindm")?b.joindm=A("#joindm"):0;var q={};return q.music=!B("#module-fun"),q.social=!B("#module-fun"),q.fun=!B("#module-fun"),b.modules=q,b}function setForm(b){if(b.prefix&&$("#prefix").val(b.prefix),b.adblock){if($("#adblock-toggle").prop("checked",b.adblock.on),$("#adblock-strikes").prop("checked",b.adblock.strikes),$("#adblock-notify").prop("checked",b.adblock.notify),b.adblock.ex&&b.adblock.ex.users){var f=[];Object.keys(b.adblock.ex.users).forEach(function(h){f.push({tag:h})}),$("#adblock-users").material_chip({data:f})}if(b.adblock.ex&&b.adblock.ex.roles){var f=[];Object.keys(b.adblock.ex.roles).forEach(function(h){f.push({tag:h})}),$("#adblock-roles").material_chip({data:f})}}if(b.filter&&($("#filter-strikes").prop("checked",b.filter.strikes),b.filter.keywords)){var f=[];Object.keys(b.filter.keywords).forEach(function(h){f.push({tag:h})}),$("#filter-keywords").material_chip({data:f})}$("#joindm").val(b.joindm),$("#module-music").prop("checked",!b.modules.music),$("#module-social").prop("checked",!b.modules.social),$("#module-fun").prop("checked",!b.modules.fun)}function clearForm(){}$(document).ready(function(){$("#adblock-users").material_chip({placeholder:"The ID of the user",secondaryPlaceholder:"The ID of the user"}),$("#adblock-users").on("chip.add",function(m,o){o.tag.match(/[^0123456789]/g)&&Materialize.toast("ID's are numerical only",3e3,"rounded red")}),$("#adblock-roles").material_chip({placeholder:"The ID of the role",secondaryPlaceholder:"The ID of the role"}),$("#adblock-roles").on("chip.add",function(m,o){o.tag.match(/[^0123456789]/g)&&Materialize.toast("ID's are numerical only",3e3,"rounded red")}),$("#filter-keywords").material_chip({placeholder:"The Keyword",secondaryPlaceholder:"The Keyword"}),$("#select-guild").material_select(),$("#load_db").tooltip({delay:50}),$("#submit_form").tooltip({delay:50}),disableForm(!0);var b=getCookie("nitroAccessToken");if(b){var f=new Date,h=f.getTime();localStorage.setItem("accessToken",JSON.stringify({token:b,date:h}))}var j=localStorage.getItem("accessToken");if(j){var k=JSON.parse(j),l=k.date,f=new Date,h=f.getTime();5.184e8<l-h&&loginRedirect()}else loginRedirect();j&&loadUserData(),$("#submit_form").click(submitButton),$("#select-guild").change(selectGuild)});function submitButton(){Materialize.toast("Submitting Configuration",3e3,"rounded blue");var b=$("#api_key").val(),f=collectForm();auth(function(h,j){j=JSON.parse(j),(h||j.error)&&Materialize.toast("Request Failed, Try Again Later",3e3,"rounded red"),j=j.auth;var k=atob(j),l=k.split(":");l.push(r);var m=l.join(":");m=btoa(m);var o=collectForm(),p=$("#select-guild").val(),q=ownedGuilds[p],r=q.id;submitDB(m,o,function(s,t){t=JSON.parse(t),(s||t.error)&&Materialize.toast("Request Failed, Try Again Later",3e3,"rounded red"),Materialize.toast("Configuration Saved To Server",3e3,"rounded green")})})}function selectGuild(){if(!ownedGuilds)return Materialize.toast("Reload Page",3e3,"rounded red");var b=$("#select-guild").val(),f=ownedGuilds[b];if(!f)return Materialize.toast("Invalid Guild Selected",3e3,"rounded red");var h=f.id;checkInGuild(h,function(j,k){return k=JSON.parse(k),j||k.error?Materialize.toast("Request Failed, Try Again Later",3e3,"rounded red"):void(k.has?loadGuild(f.id):(Materialize.toast("Nitro is not in this server",3e3,"rounded red"),setTimeout(function(){window.location.href="https://discordapp.com/oauth2/authorize?client_id=264087705124601856&scope=bot&permissions=170929206"},2e3)))})}function loadGuild(b){auth(function(f,h){h=JSON.parse(h),(f||h.error)&&Materialize.toast("Request Failed, Try Again Later",3e3,"rounded red"),h=h.auth;var j=atob(h),k=j.split(":");k.push(b);var l=k.join(":");l=btoa(l),loadDB(l,function(m,o){o=JSON.parse(o),(m||o.error)&&Materialize.toast("Request Failed, Try Again Later",3e3,"rounded red"),setForm(o),disableForm(),Materialize.toast("Loading Configuration",3e3,"rounded green")})})}function loadUserData(){Materialize.toast("Fetching Guilds...",3e3,"rounded blue"),fetchUserInfo(function(b,f){return f=JSON.parse(f),b||f.error?Materialize.toast("Request Failed, Try Again Later",3e3,"rounded red"):0===f.guilds.length?Materialize.toast("You Do Not Own Any Servers",3e3,"rounded red"):void(fillProfile(f.user),fillDropdown(f.guilds))})}function fillProfile(b){$("#profile-img").attr("src",b.avatarURL),$("#profile-text").attr("class","brand-logo"),10<b.username.length&&(b.username=b.username.substring(0,10)),$("#profile-text").text(b.username)}function fillDropdown(b){var f=[];f.push("<option value=\"\" disabled selected>Choose an option</option>"),b.forEach(function(j,k){var l=j.name;25<l.length&&(l=l.substring(0,25));var m="<option value=\""+k+"\" data-icon=\""+j.iconURL+"\" class=\"circle\">"+l+"</option>";f.push(m)}),ownedGuilds=b,$("#select-guild").html(f.join(" ")),$("#select-guild").removeAttr("disabled"),$("#select-guild").material_select()}function loginRedirect(){Materialize.toast("Logging In...",3e3,"rounded blue"),auth(function(b,f){if(f=JSON.parse(f),b||f.error)return Materialize.toast("Login Failed, Try Again Later",3e3,"rounded red");var h=atob(f.auth),j=h.split(":"),k=j[0],l=j[1];login(f,function(m,o){return o=JSON.parse(o),m||o.error?Materialize.toast("Login Failed, Try Again Later",3e3,"rounded red"):void(window.location.href=o.url)})})}function disableForm(){var f=0<arguments.length&&arguments[0]!==void 0&&arguments[0],b=["submit_form","prefix","adblock-toggle","adblock-strikes","adblock-notify","adblock-users","adblock-roles","filter-strikes","filter-keywords","joindm","module-music","module-fun","module-social"];if(f)for(i=0;i<b.length;i++)$("#"+b[i]).attr("disabled","true");else for(i=0;i<b.length;i++)$("#"+b[i]).removeAttr("disabled")}function checkInGuild(b,f){$.ajax({url:"/api/inguild",method:"GET",headers:{guildid:b},error:function error(h,j){f(j,!1)},success:function success(h){f(!1,h)}})}function fetchUserInfo(b){var f=getToken();$.ajax({url:"/api/userinfo",method:"GET",headers:{Authorization:"Basic "+f},error:function error(h,j){b(j,!1)},success:function success(h){b(!1,h)}})}function auth(b){var h=btoa("ruojrb5enfktpkd2d6yg8vcmop5z12yl6lv3u4plwc");$.ajax({url:"/api/authorize",method:"GET",headers:{Authorization:"Basic "+h},error:function error(j,k){b(k,!1)},success:function success(j){b(!1,j)}})}function login(b,f){b=b.auth,$.ajax({url:"/api/login",method:"GET",headers:{Authorization:"Basic "+b},error:function error(h,j){f(j,!1)},success:function success(h){f(!1,h)}})}function submitDB(b,f,h){$.ajax({url:"/api/database",method:"POST",headers:{Authorization:b,data:JSON.stringify(f)},dataType:"json",data:JSON.stringify(f),error:function error(j,k){h(k,null)},success:function success(j){h(null,j)}})}function loadDB(b,f){$.ajax({url:"/api/database",method:"GET",headers:{Authorization:"Basic "+b},error:function error(h,j){f(j,null)},success:function success(h){f(null,h)}})}function A(b){return 0!==$(b).val().length&&$(b).val()}function B(b){return $(b).prop("checked")}function getOptionals(b){var h=window.location.href,j=new RegExp("[?&]"+b+"=([^&#]*)","i"),k=j.exec(h);return k?k[1]:null}function getToken(){var b=localStorage.getItem("accessToken");if(!b)return null;var f=JSON.parse(b);return f.token}"function"!=typeof String.prototype.trimLeft&&(String.prototype.trimLeft=function(){return this.replace(/^\s+/,"")}),"function"!=typeof String.prototype.trimRight&&(String.prototype.trimRight=function(){return this.replace(/\s+$/,"")}),"function"!=typeof Array.prototype.map&&(Array.prototype.map=function(b,f){for(var h=0,j=this.length,k=[];h<j;h++)h in this&&(k[h]=b.call(f,this[h]));return k});function getCookies(){var b=document.cookie,f=0,h={};return document.cookie.match(/^\s*\$Version=(?:"1"|1);\s*(.*)/)&&(b=RegExp.$1,f=1),0==f?b.split(/[,;]/).map(function(j){var k=j.split(/=/,2),l=decodeURIComponent(k[0].trimLeft()),m=1<k.length?decodeURIComponent(k[1].trimRight()):null;h[l]=m}):b.match(/(?:^|\s+)([!#$%&'*+\-.0-9A-Z^`a-z|~]+)=([!#$%&'*+\-.0-9A-Z^`a-z|~]*|"(?:[\x20-\x7E\x80\xFF]|\\[\x00-\x7F])*")(?=\s*[,;]|$)/g).map(function(j,k){var m="\""===k.charAt(0)?k.substr(1,-1).replace(/\\(.)/g,"$1"):k;h[j]=m}),h}function getCookie(b){return getCookies()[b]}